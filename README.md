# SaaS CRM Database

Учебный проект базы данных для SaaS‑CRM системы. Репозиторий содержит DDL‑скрипты, миграции, тестовые данные и примеры функций/отчётов для CRM: сделки, клиенты, сотрудники, задачи, коммуникации.

## Структура проекта

- `ddl/` — базовые DDL‑скрипты:
    - создание схемы `saas_crm`;
    - создание таблиц (client, deal, employee, task, product, product_by_deal и др.);
    - создание ограничений и индексов.

- `migrations/` — пошаговые миграции схемы:
    - добавление новых таблиц/полей;
    - изменения структуры;
    - все изменения оформлены отдельными версиями миграций.

- `test_data/` — тестовые данные:
    - начальное заполнение таблиц (клиенты, сотрудники, сделки, продукты и т.п.);
    - данные используются для демонстрации отчётов и запросов.

- `queries_and_functions/` — прикладные запросы и функции:
    - функции для истории коммуникаций, отчётов по менеджерам, работе с задачами;
    - примеры сложных SELECT с CTE и оконными функциями;
    - DML‑сценарии с транзакциями (создание сделок, перенос задач и т.д.).

- `docs/` — документация:
    - описания сущностей и связей;
    - пояснения к ключевым функциям, отчётам и сценариям.

- `utils/` — вспомогательные скрипты (если есть):
    - настройки, служебные SQL‑скрипты и утилиты.

## Как поднять БД с нуля

1. Установить PostgreSQL (версии 14+ достаточно).
2. Создать базу данных, например: CREATE DATABASE saas_crm;
3. Подключиться к ней (psql или через DataGrip) и выполнить базовые DDL‑скрипты:

- либо напрямую выполнить скрипты из каталога `ddl/` в логическом порядке (создание схемы → таблицы → индексы),
- либо через один объединённый скрипт, если он есть (например, `ddl/init.sql`).

4. Применить миграции из каталога `migrations/` в том порядке, в котором они пронумерованы.  
   Это обновит схему до актуальной версии.

5. Загрузить тестовые данные:

- выполнить скрипты из `test_data/` (создание примеров клиентов, сотрудников, сделок, продуктов и т.д.);
- после этого БД будет готова для запуска примеров отчётов.

6. Выполнить прикладные функции и запросы:

- подключить скрипты из `queries_and_functions/`;
- после выполнения там появятся функции вроде `get_chat_history(...)`, отчёты по менеджерам, списки просроченных задач и другие инструменты.

## Как пользоваться

- Для просмотра структуры и связей — использовать DDL из `ddl/` и документацию из `docs/`.
- Для демонстрации отчётности и бизнес‑логики:
- запускать функции и запросы из `queries_and_functions/` на тестовых данных;
- использовать их как примеры сложных SQL‑запросов, транзакций и оконных функций.

Проект ориентирован на учебное использование: демонстрацию нормализованной структуры БД CRM‑системы, транзакций, индексов и сложных SQL‑отчётов.
