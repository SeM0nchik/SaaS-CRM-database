## Краткое описание

Вы проектируете базу данных для облачной SaaS CRM системы для компаний. Каждая компания ведет свою клиентскую и торговую работу в одном сервисе.

- На платформе есть *Компании* ( каждая компания независима и не видит чужих данных). Внутри каждой компании есть *Пользователи* ( сотрудники различных ролей: менеджеры, администраторы и сотрудники). У всех пользователей есть ФИО, email,   дата регистрации, а также принадлежность к своей компании.
- *Компания* может иметь много *Клиентов* (контактных лиц или орагнизаций). Каждый клиент записывается с ФИО, компанией, должностью, номером телефона и email.
- *Пользователь* может создавать и вести несколько *Сделок* с клиентами. Сделка всегда принадлежит только 1ой компании, одному сотруднику-ответственному и одному клиенту. У сделки есть название, описание, сумма, статус. Для каждой сделки фиксируется дата создания и дата закрытия.
- У каждой *Сделки* есть один или несколько уникальных *Тэгов*.
- В каждую *Сделку* может входить несколько *Товаров*, у которого есть свой идентификатор, имя, цена за 1 шт и описание
- По каждой сделке сотрудники могут ставить *Задачи* (например, звонок, встреча, письмо, презентация ). Одна сделка может иметь много задач; каждая задача относиться только к конкретному сотрудник, каждая задача имеет тип ( звонок, встреча, задача) сроки, результат, статус.
- К задаче/сделке/ комментарию может быть сделан текстовый *Комментарий*.
- Все важные действия (создание/изменение/закрытие сделки/выполнение задачи/смена клиента/смена ответственного) фиксируется в *Журнале действий* ( логах ) - по ним можно в любой момент просмотреть историю работы по клиенту или по сделке
- Когда сделка переводиться в статус 'закрыта' компания может сохранить *Отзыв клиента*: рейтинг по 5-балльной шкале и текстовый комментарий, время создания.
- Система позволяет хранить информацию о входящей и исходящей почте, получаемой по текущей сделке, а также хранит информацию о всех звонках ( есть логи звонков ) по данной сделке и система хранит информацию о сообщениях по сделке.
- В базе реализована система ролей: у каждого пользователя есть роли (менеджер, администратор, сотрудник)
    - Администратор: **Полный доступ** ко всем данным компании, к настройкам, редактированию и управлению всеми элементами CRM.
        - Добавлять/удалять сотрудников.
        - Назначать роли (менеджер/сотрудник) другим пользователям.
        - Сброс паролей и разблокировка пользователей.
        - Создавать/удалять/редактировать справочники, формы, поля и шаблоны.
        - Просматривать, создавать, редактировать и удалять любые сделки, контакты, задачи.
        - Просматривать историю всех действий и изменений по всей компании.
        - Определять/менять права для всех ролей, групп сотрудников/отделов.
        - Не видит данные других компаний.
    - Менеджер:
        - Просматривать, создавать и редактировать свои сделки, задачи, клиентов.
        - Может видеть сделки/контакты, где он назначен ответственным (или где состоит в качестве участника задачи).
        - Менять статусы сделок, закрывать/открывать сделки, назначать задачи себе и коллегам из отдела (если разрешено).
        - Добавлять новых клиентов, редактировать их данные.
        - Просматривать отчеты по своим продажам/задачам.
        - Видеть свой рейтинг, историю своих задач и сделок.
        - Не может изменить роли сотрудников и доступ других пользователей.
        - Не может удалить других пользователей или менять права.
        - Доступ обычно строго ограничен “своими” данными и задачами, данными своей компании.
        - Видит, редактирует и закрывает только те сделки/задачи, за которые отвечает, или которые заведены на него/его отдел.
    - Сотрудник:
        - Видит свои задачи, сделки, клиентов (только те, где назначен исполнителем или участником).​
        - Может добавлять комментарии, отмечать выполнение задач.
        - Может создавать задачи/заметки по уже существующим клиентам/сделкам (если разрешено политикой).
        - Завершение/отметка о выполнении заданий.
        - Видит историю только своих действий.
        - Никакого доступа к управлению пользователями, настройкам, удалению данных.
        - Не может просматривать сделки/задачи, не относящиеся к ним.
        - Не может создавать новых клиентов/сделок, если не разрешено (по политике компании).
        - Не может изменять права, настройки системы.

## Создание ER-модели на основе требований

### Сущности и их аттрибуты

- Компания ( company ) : company_id, company_name, company_desc, registration_date
- Пользователь ( employees ) : company_id, employee_id, employee_name, employee_email, registration_date, role
- Клиент ( clients ) : client_id, company_id, client_name, client_email, client_phone, client_post
- Сделка ( deal ): deal_id, client_id, company_id, deal_name, deal_desc, amount, deal_status, creation_date, close_date
- Товар ( product ): product_id, product_name, product_desc, product_price
- Задача ( task ) : task_id, deal_id, employee_id, task_desc, task_deadline, task_status, task_result
- Комментарий (comment) : (comment_id, object_type, object_id, employee_id, comment_text, created_at)
- Журнал действий ( activity_logs ):  log_id, company_id, user_id, username, role, action_type, object_type, object_id, object_name, status, message
- Отзыв клиента ( client_review ) : client_id, deal_id, creation_date, rating, text
- Тэги (tags) : tag_id, tag_name, tag_desc
- Сообщения по почте ( email_message ) : email_id, company_id, client_id, deal_id, direction, subject, body, sent_at
- Логи звонков ( call_logs ): call_id, company_id, client_id, deal_id, direction, phone, duration, call_at
- Сообщения в чатах (chat_messages) : message_id, company_id, client_id, deal_id, channel, sender_type, sender_id, body, sent_at

### Связи и их кардинальность

- Работник принадлежит одной определенной компании. Кард  M : 1
- У компании может быть множество клиентов. Кард 1 : M
- Компания заключает сделку с клиентом.  M : N -> отдельная табличка deal где хранится все информация о сделке а также о клиенте, с которым идет сделка
- В сделку входит множество товаров. M : N -> нужна отдельная табличка product_by_deal где мы будем хранить информацию о том сколько и каких товаров входит в какую сделку
- У каждой сделки есть множество задач. 1 : M
- Пользователь оставляет комментарий на сделку/заметку/др. 1 : M
- Все запросы и изменения регистрируются в логах
- Клиент может оставить отзыв на сделку. 1 : M
- Каждая сделка имеет несколько тэгов. M : N -> требуется отдельная таблица deal_by_tags хранящая информацию о сделке и ее тэге.
- Каждая сделка имеет несколько почтовых сообщений. 1 : N
- Каждая сделка имеет несколько сообщений в чатах.  1 : N
- Каждая сделка имеет историю звонков. 1 : N 