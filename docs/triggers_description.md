## Описание триггеров 

Этот раздел содержит следущую информацию о триггерах saas crm database

– **Описание** (что это за сущность),     
– **Когда вызывается** (CRUD),  
– **Список триггеров** (реализованные триггеры)

---
### Триггеры-чекеры

**Описание**: В представленной базе данных имеются несколько триггеров,
основная задача которых - при вставке в таблицу проверять определенные бизнес правила.
Например, у каждой **deal** есть менеджер ( ответственное лицо ), который является сотрудником.  

При вставке в **deal** необходимо проверять, что сотрудник действительно менеджер - для этого мы используем триггер. 

**Когда вызывается**: BEFORE INSERT или UPDATE в **deal**

**Список триггеров**: *trg_check_deal_manager_id*.

---
### Триггеры-протекторы

**Описание**:  Как и в прошлом пункте задача этих триггеров - защитить таблицу от некорректных данных. 
Протекторы основаны на бизнес правилах. Например, при изменении данных о комментарии или о сообщении должен менять только текст/тема, 
но отправитель, время, id и другие меняться аттрибуты не должны. Другой пример - в таблице-связке тэгов и сделок не должно быть изменений. 
То есть можно либо удалить либо создать новую связь. Обновлять существующую свяьзь нет смысла.

**Когда вызывается**: BEFORE INSERT или UPDATE в **comment** или **tag_by_deal** или **product_by_deal**

**Список триггеров**: *trg_protect_comment_fields*, *trg_protect_tag_by_deal_fields*, *trg_protect_product_by_deal_ids*.  

---
### Триггеры-логи 

**Описание**: Задача этих триггеров - записывать всю информацию в специальную таблицу log_activities. 
Там хранится информация о том, какой пользователь произвел ту или иную операцию. Какой объект и какого типа он изменил/удалил/создал. 

**Когда вызывается**: BEFORE INSERT или UPDATE или DELETE во все таблички, кроме таблиц, в которых хранится информация о сообщениях и звонках.

**Список триггеров**: *trg_log_client_activity*, *trg_log_employee_activity*, *trg_log_deal_changes*, *trg_log_product_changes*, *trg_log_task_changes*, *trg_log_comment_changes*,
*trg_log_deal_tags_changes*, *trg_log_product_by_deal_activity*, *trg_log_tag_changes*.  

---

### Триггеры-события

**Описание**: Задача этих тригеров срабатывать на определенное событие. Например: сделка изменила свой статус на завершила, значит
ее close_date должна автоматически изменится. Такая же логика при изменении статуса задачи.

**Когда вызывается**: BEFORE INSERT или UPDATE в **deal** или **task**

**Список триггеров**: *trg_close_deal*, *trg_change_task_status*.  
