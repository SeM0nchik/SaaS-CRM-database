## Роли и разрешения 

Этот раздел содержит формализацию бизнес-ролей CRM. Для каждой роли указываются:  
– **Описание** (что это за сущность),  
– **CRUD-таблица** (Create Read Update Delete права где строками выступают сущности и таблички),
---
### Администратор (admin)
Это администратор CRM системы, у которого есть полный доступ ко всем данным компании.  
Он может назначать менеджеров и сотрудников и распределять сделки по менеджерам.

| Сущность        | Create | Read | Update | Delete | Ограничения |
|-----------------|----|------|----|----|-------------|
| company         | -  | ✓    | -  | -  | Только свою компанию, создание делает глобальный супер‑админ/SAAS |
| employee        | ✓  | ✓    | ✓  | ✓  | Только сотрудники своей компании |
| client          | ✓  | ✓    | ✓  | ✓  | Все клиенты своей компании |
| deal            | ✓  | ✓    | ✓  | ✓  | Все сделки своей компании |
| product         | ✓  | ✓    | ✓  | ✓  | Товары своей компании |
| task            | ✓  | ✓    | ✓  | ✓  | Все задачи своей компании |
| comment         | ✓  | ✓    | ✓  | ✓  | Все комментарии своей компании |
| activity_logs   | -  | ✓    | -  | -  | Вся история действий своей компании |
| client_review   | -  | ✓    | -  | -  | Все отзывы по сделкам своей компании |
| tags            | ✓  | ✓    | ✓  | ✓  | Теги своей компании |
| deal_by_tag     | ✓  | ✓    | ✓  | ✓  | Связи сделка–тег в своей компании |
| email_message   | ✓    | ✓    | ✓    | ✓    | Вся почтовая переписка по сделкам компании |
| call_logs       | ✓    | ✓    | ✓    | ✓    | Все звонки по сделкам компании |
| chat_message    | ✓    | ✓    | ✓    | ✓    | Все сообщения по сделкам компании |
| product_by_deal | ✓    | ✓    | ✓    | ✓    | Просмотр состава сделок; правка через сами сделки/товары |


### Менеджер (manager)
Это менеджер, который занимается сделками, делегирует задачи по ней сотрудникам. 
Он управляет сделками и сотрудниками, но не может менять их права доступа и роли.

| Сущность        | Create | Read | Update | Delete | Ограничения                                                             |
|-----------------|-----|------|--------|----|-------------------------------------------------------------------------|
| company         | -   | ✓    | -      | -  | Только свою компанию (просмотр базовой инфы)                            |
| employee        | -   | ✓    | -      | -  | Видит сотрудников своей компании (для назначения задач)                 |
| client          | ✓   | ✓    | ✓      | -  | Клиенты своей компании; в работе в основном “свои” клиенты              |
| deal            | ✓   | ✓    | ✓      | -  | Сделки своей компании, полноценно управляет только теми, где он manager_id |
| product         | -   | ✓    | -      | -  | Просмотр справочника товаров компанииж;                           |
| task            | ✓   | ✓    | ✓      | ✓  | Задачи по сделкам своей компании; назначает себе и сотрудникам          |
| comment         | ✓   | ✓    | ✓      | ✓  | Комментарии к задачам/сделкам, где он имеет доступ                      |
| activity_logs   | -   | ✓    | -      | -  | Логи по своим сделкам/задачам (фильтрация по его объектам)              |
| client_review   | -   | ✓    | -      | -  | Может сохранять отзыв по своим закрытым сделкам, читать отзывы по своим сделкам |
| tags            | -   | ✓    | -      | -  | Просмотр тегов компании                                                 |
| deal_by_tag     | ✓   | ✓    | ✓      | ✓  | Видит связи тегов со “своими” сделками и может взаимодествовать только со своими сделками |
| email_message   | ✓   | ✓    | -      | -  | Письма по своим сделкам (входящие/исходящие), может создавать новые     |
| call_logs       | ✓   | ✓    | -      | -  | Логи звонков по своим сделкам, может фиксировать новые                  |
| chat_message    | ✓   | ✓    | -      | -  | Сообщения по своим сделкам, может отвечать клиенту/делегировать сотрудникам |
| product_by_deal | ✓   | ✓    | ✓      | ✓  | Видит состав своих сделок (товары и цены в сделке) и может их менять редактировать |


### Сотрудник (employee)
Это обычный сотрудник, который может ограничено взаимодействовать с клиентом и задачами по сделке.  
В остальном у него readonly права на данные без возможности редактирования и внесения правок.  

| Сущность        | Create | Read | Update | Delete | Ограничения |
|-----------------|--------|------|----|------|-------------|
| company         | -      | ✓    | -  | -    | Видит только базовую инфу о своей компании (название и т.п.) |
| employee        | -      | ✓    | -  | -    | Может видеть только себя и, опционально, коллег отдела (для задач/чатов) |
| client          | -      | ✓    | -  | -    | Клиенты, связанные со сделками/задачами, где он исполнитель/участник |
| deal            | -      | ✓    | -  | -    | Сделки, по которым у него есть задачи или коммуникации |
| product         | -      | ✓    | -  | -    | Просмотр справочника товаров (для понимания состава сделок) |
| task            | -      | ✓    | ✓  | -    | Только свои задачи (где employee_id = он); может менять статус/результат |
| comment         | ✓      | ✓    | ✓  | ✓    | Комментарии к своим задачам/сделкам, ответы на чужие комментарии в рамках этих задач |
| activity_logs   | -      | ✓    | -  | -    | Видит только историю своих действий (фильтр по user_id = он) |
| client_review   | -      | ✓    | -  | -    | Может просматривать отзывы по сделкам, к которым имеет доступ |
| tags            | -      | ✓    | -  | -    | Просмотр тегов, используемых в “его” сделках |
| deal_by_tag     | -      | ✓    | -  | -    | Видит связи тегов только для сделок, к которым имеет доступ |
| email_message   | ✓      | ✓    | ✓  | -    | Письма по сделкам, где он участвует (по делегированию менеджера) |
| call_logs       | ✓      | ✓    | ✓  | -    | Фиксация и просмотр звонков по своим задачам/сделкам |
| chat_message    | ✓      | ✓    | ✓  | -    | Сообщения по сделкам, где он участвует; может отвечать клиенту по делегированию |
| product_by_deal | -      | ✓    | -  | -    | Видит состав сделок, в которых задействован через задачи/коммуникации |

